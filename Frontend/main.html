<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Traffic Monitoring System - Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b1020;
      --card: #151a2c;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.15);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #ef4444;
      --success: #22c55e;
      --border: #1f2937;
      --radius-lg: 14px;
      --radius-md: 10px;
      --radius-sm: 6px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.6);
      --shadow-chip: 0 8px 20px rgba(15, 23, 42, 0.7);
      --blur: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d283a 0, #020617 55%);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .shell {
      width: 100%;
      max-width: 1120px;
      background: radial-gradient(circle at top left, #1f2937 0, #020617 55%);
      border-radius: 24px;
      padding: 22px 22px 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.15);
      position: relative;
      overflow: hidden;
    }

    .shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 10% 0, rgba(56, 189, 248, 0.08) 0, transparent 45%),
        radial-gradient(circle at 90% 0, rgba(129, 140, 248, 0.16) 0, transparent 50%);
      opacity: 0.9;
      pointer-events: none;
    }

    .window {
      position: relative;
      z-index: 1;
      background: rgba(15, 23, 42, 0.88);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(var(--blur));
      padding-bottom: 18px;
      overflow: hidden;
    }

    .window-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px 10px 16px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      background: linear-gradient(
        135deg,
        rgba(15, 23, 42, 0.85),
        rgba(15, 23, 42, 0.75)
      );
    }

    .window-title-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .traffic-dots {
      display: flex;
      gap: 6px;
    }

    .traffic-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #4b5563;
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.7);
    }

    .traffic-dot.red {
      background: #f87171;
    }
    .traffic-dot.yellow {
      background: #fde68a;
    }
    .traffic-dot.green {
      background: #4ade80;
    }

    .window-title-text {
      font-size: 13px;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 8px;
      letter-spacing: 0.02em;
    }

    .window-title-text strong {
      font-weight: 600;
      color: #e5e7eb;
    }

    .pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.16);
      border: 1px solid rgba(34, 197, 173, 0.35);
      color: #a5f3fc;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.4);
    }

    .window-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--muted);
    }

    .window-chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow-chip);
    }

    .window-chip strong {
      font-size: 11px;
      color: #e5e7eb;
    }

    .window-body {
      padding: 14px 16px 12px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(260px, 2fr);
      gap: 14px;
    }

    @media (max-width: 820px) {
      .window-body {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: radial-gradient(circle at top left, #111827 0, #020617 65%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 14px 14px 12px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at top right,
        rgba(59, 130, 246, 0.3) 0,
        transparent 55%
      );
      opacity: 0.18;
      pointer-events: none;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
      gap: 8px;
    }

    .panel-title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.18);
      border: 1px solid rgba(59, 130, 246, 0.5);
      font-size: 11px;
      color: #bfdbfe;
    }

    .panel-sub {
      font-size: 12px;
      color: var(--muted);
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .tag {
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(75, 85, 99, 0.85);
      color: #d1d5db;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tag-key {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.85);
    }

    .fields {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 10px;
      margin-bottom: 12px;
    }

    @media (max-width: 640px) {
      .fields {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field {
      background: rgba(15, 23, 42, 0.95);
      border-radius: var(--radius-md);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 8px 10px 7px;
    }

    .field-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .field-label span {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }

    .field-input {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    input[type="text"] {
      width: 100%;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      padding: 7px 9px;
      font-size: 13px;
      color: var(--text);
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background-color 0.15s;
    }

    input[type="text"]:focus {
      border-color: rgba(59, 130, 246, 0.9);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.75);
      background: rgba(15, 23, 42, 1);
    }

    input[type="file"] {
      font-size: 12px;
      color: var(--muted);
    }

    input[type="file"]::file-selector-button {
      margin-right: 10px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(
        135deg,
        rgba(59, 130, 246, 0.95),
        rgba(129, 140, 248, 0.95)
      );
      color: white;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        filter 0.12s ease;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.55);
    }

    input[type="file"]::file-selector-button:hover {
      filter: brightness(1.07);
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(37, 99, 235, 0.7);
    }

    input[type="file"]::file-selector-button:active {
      transform: translateY(0);
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.6);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.02em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 7px;
      color: white;
      background: linear-gradient(
        135deg,
        rgba(59, 130, 246, 0.98),
        rgba(129, 140, 248, 0.98)
      );
      box-shadow: 0 10px 26px rgba(30, 64, 175, 0.65);
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        filter 0.12s ease;
    }

    button.secondary {
      background: rgba(31, 41, 55, 0.96);
      color: #e5e7eb;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(75, 85, 99, 0.9);
    }

    button.small {
      padding: 5px 10px;
      font-size: 11px;
    }

    button:hover {
      filter: brightness(1.04);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 5px 14px rgba(15, 23, 42, 0.85);
    }

    button:disabled {
      opacity: 0.55;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .status-line {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #6b7280;
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
      transition: background 0.18s ease, box-shadow 0.18s ease;
    }

    .status-dot.ok {
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(22, 163, 74, 0.38);
    }
    .status-dot.error {
      background: #ef4444;
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.38);
    }
    .status-dot.loading {
      background: #facc15;
      box-shadow: 0 0 0 4px rgba(234, 179, 8, 0.38);
    }

    .status-text-strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .log-container {
      background: rgba(15, 23, 42, 0.98);
      border-radius: var(--radius-md);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 8px 9px;
      max-height: 210px;
      overflow: auto;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo,
        Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      line-height: 1.4;
      color: #e5e7eb;
      background-image: linear-gradient(
          rgba(15, 23, 42, 0.7) 1px,
          transparent 1px
        ),
        linear-gradient(90deg, rgba(15, 23, 42, 0.7) 1px, transparent 1px);
      background-size: 0 0;
    }

    .log-entry {
      padding: 4px 5px;
      border-radius: 6px;
      margin-bottom: 3px;
      border: 1px solid transparent;
      display: flex;
      align-items: baseline;
      gap: 6px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .log-entry.info {
      border-color: rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
    }

    .log-entry.ok {
      border-color: rgba(22, 163, 74, 0.9);
      background: rgba(6, 78, 59, 0.45);
    }

    .log-entry.error {
      border-color: rgba(239, 68, 68, 0.9);
      background: rgba(127, 29, 29, 0.45);
    }

    .log-time {
      color: #9ca3af;
      font-size: 10px;
      min-width: 57px;
    }

    .log-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(156, 163, 175, 0.7);
      color: #e5e7eb;
    }

    .log-label.ok {
      border-color: rgba(22, 163, 74, 0.9);
    }
    .log-label.error {
      border-color: rgba(220, 38, 38, 0.9);
    }

    .log-message {
      flex: 1;
    }

    .log-meta {
      color: #9ca3af;
      margin-top: 2px;
      font-size: 10px;
    }

    .metrics-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    @media (max-width: 640px) {
      .metrics-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .metric-card {
      background: radial-gradient(circle at top, #111827 0, #020617 60%);
      border-radius: var(--radius-md);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 7px 9px;
      font-size: 11px;
    }

    .metric-label {
      color: #9ca3af;
      margin-bottom: 3px;
    }

    .metric-value {
      font-size: 14px;
      font-weight: 600;
      color: #e5e7eb;
    }

    .metric-sub {
      font-size: 10px;
      color: #6b7280;
      margin-top: 1px;
    }

    .hint {
      margin-top: 8px;
      font-size: 11px;
      color: #6b7280;
    }

    a {
      color: #bfdbfe;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="window">
      <div class="window-header">
        <div class="window-title-group">
          <div class="traffic-dots">
            <div class="traffic-dot red"></div>
            <div class="traffic-dot yellow"></div>
            <div class="traffic-dot green"></div>
          </div>
          <div class="window-title-text">
            <strong>Traffic Monitoring System</strong>
            <span>FastAPI · ESP32-CAM</span>
          </div>
        </div>
        <div class="window-actions">
          <div class="pill">
            <span class="pill-dot"></span>
            Live session
          </div>
          <div class="window-chip">
            <span style="width: 6px; height: 6px; border-radius: 999px; background: #38bdf8;"></span>
            <strong>Backend:</strong>
            <span id="chip-host">http://localhost:8000</span>
          </div>
        </div>
      </div>

      <div class="window-body">
        <!-- Left: Controls + Health -->
        <section class="panel">
          <div class="panel-header">
            <div class="panel-title">
              <span>●</span>
              <div>
                ESP32-CAM Uploader
              </div>
            </div>
            <div class="panel-sub">
              Send frames & monitor FastAPI status in real time.
            </div>
          </div>

          <div class="tag-row">
            <div class="tag">
              <span class="tag-dot"></span>
              <span class="tag-key">endpoint</span>
              <span id="endpoint-label">/upload_frame</span>
            </div>
            <div class="tag">
              <span class="tag-key">method</span>
              POST · multipart/form-data
            </div>
            <div class="tag">
              <span class="tag-key">esp32</span>
              multiple frames per request
            </div>
          </div>

          <div class="fields">
            <div class="field">
              <div class="field-label">
                Backend base URL
                <span>config</span>
              </div>
              <div class="field-input">
                <input
                  id="base-url"
                  type="text"
                  value="http://localhost:8000"
                  autocomplete="off"
                />
              </div>
            </div>

            <div class="field">
              <div class="field-label">
                ESP32-CAM file upload
                <span>frames</span>
              </div>
              <div class="field-input">
                <input
                  id="file-input"
                  type="file"
                  accept="image/*"
                  multiple
                />
              </div>
            </div>
          </div>

          <div class="controls">
            <button id="btn-health">
              <span>●</span>
              Check API Health
            </button>
            <button id="btn-upload" class="secondary">
              <span>⇪</span>
              Upload Selected Frames
            </button>
            <button id="btn-clear" class="secondary small">
              Clear log
            </button>
          </div>

          <div class="status-line">
            <div id="status-dot" class="status-dot"></div>
            <div id="status-text">
              Waiting for actions…
            </div>
          </div>

          <div class="metrics-row">
            <div class="metric-card">
              <div class="metric-label">Total uploads (this page)</div>
              <div id="metric-uploads" class="metric-value">0</div>
              <div class="metric-sub">Frames successfully delivered</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Last batch size</div>
              <div id="metric-batch" class="metric-value">0</div>
              <div class="metric-sub">Files in most recent request</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Last health check</div>
              <div id="metric-health" class="metric-value">–</div>
              <div class="metric-sub">Status from /health</div>
            </div>
          </div>

          <p class="hint">
            Tip: you can open this page on any device on the same network and point
            the base URL at your FastAPI server (for example
            <code>http://&lt;server-ip&gt;:8000</code>).
          </p>
        </section>

        <!-- Right: Log / Results -->
        <section class="panel">
          <div class="panel-header">
            <div class="panel-title">
              <span>◎</span>
              <div>API Responses & Frame Metadata</div>
            </div>
            <div class="panel-sub">
              Inspect exactly what the backend is returning.
            </div>
          </div>

          <div id="log" class="log-container">
            <!-- log entries appended here -->
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const baseUrlInput = document.getElementById("base-url");
      const chipHost = document.getElementById("chip-host");
      const endpointLabel = document.getElementById("endpoint-label");
      const fileInput = document.getElementById("file-input");
      const btnHealth = document.getElementById("btn-health");
      const btnUpload = document.getElementById("btn-upload");
      const btnClear = document.getElementById("btn-clear");
      const statusDot = document.getElementById("status-dot");
      const statusText = document.getElementById("status-text");
      const log = document.getElementById("log");

      const metricUploads = document.getElementById("metric-uploads");
      const metricBatch = document.getElementById("metric-batch");
      const metricHealth = document.getElementById("metric-health");

      let uploadCount = 0;

      function fmtTime(d) {
        return d.toLocaleTimeString(undefined, {
          hour12: false,
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
      }

      function setStatus(kind, message) {
        statusDot.classList.remove("ok", "error", "loading");
        if (kind === "ok") statusDot.classList.add("ok");
        else if (kind === "error") statusDot.classList.add("error");
        else if (kind === "loading") statusDot.classList.add("loading");
        statusText.innerHTML = message;
      }

      function addLog(kind, label, message, meta) {
        const entry = document.createElement("div");
        entry.className = `log-entry ${kind}`;

        const time = document.createElement("div");
        time.className = "log-time";
        time.textContent = fmtTime(new Date());

        const labelEl = document.createElement("div");
        labelEl.className = "log-label" + (kind === "ok" ? " ok" : kind === "error" ? " error" : "");
        labelEl.textContent = label;

        const content = document.createElement("div");
        content.className = "log-message";
        content.textContent = message;

        entry.appendChild(time);
        entry.appendChild(labelEl);
        entry.appendChild(content);

        if (meta) {
          const metaEl = document.createElement("div");
          metaEl.className = "log-meta";
          metaEl.textContent = typeof meta === "string" ? meta : JSON.stringify(meta, null, 2);
          entry.appendChild(metaEl);
        }

        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
      }

      function getBaseUrl() {
        const v = baseUrlInput.value.trim();
        if (!v) return "http://localhost:8000";
        return v.replace(/\/+$/, "");
      }

      baseUrlInput.addEventListener("input", () => {
        const base = getBaseUrl();
        chipHost.textContent = base;
      });

      btnClear.addEventListener("click", () => {
        log.innerHTML = "";
        addLog("info", "log", "Cleared log.", null);
      });

      btnHealth.addEventListener("click", async () => {
        const base = getBaseUrl();
        const url = base + "/health";
        setStatus("loading", `<span class="status-text-strong">Checking health</span> at <code>${url}</code>…`);
        addLog("info", "health", `GET ${url}`);

        try {
          const res = await fetch(url, { method: "GET" });
          const text = await res.text();
          let data = null;
          try {
            data = JSON.parse(text);
          } catch {
            data = text;
          }

          if (res.ok) {
            metricHealth.textContent = (data && data.status) || res.status;
            setStatus(
              "ok",
              `<span class="status-text-strong">Healthy</span> · status ${res.status}`
            );
            addLog("ok", "health OK", `Response ${res.status}`, data);
          } else {
            metricHealth.textContent = "error";
            setStatus(
              "error",
              `<span class="status-text-strong">Health check failed</span> · status ${res.status}`
            );
            addLog("error", "health error", `Response ${res.status}`, data);
          }
        } catch (err) {
          metricHealth.textContent = "offline";
          setStatus(
            "error",
            `<span class="status-text-strong">Could not reach backend</span> (${err})`
          );
          addLog("error", "health error", "Network error while calling /health", String(err));
        }
      });

      btnUpload.addEventListener("click", async () => {
        const files = fileInput.files;
        if (!files || !files.length) {
          setStatus("error", `<span class="status-text-strong">No files selected</span> · choose one or more frames first.`);
          addLog("error", "upload", "No files selected.", null);
          return;
        }

        const base = getBaseUrl();
        const url = base + "/upload_frame";

        const form = new FormData();
        for (let i = 0; i < files.length; i++) {
          form.append("files", files[i], files[i].name || `frame_${i}.jpg`);
        }

        setStatus(
          "loading",
          `<span class="status-text-strong">Uploading</span> ${files.length} frame(s) to <code>${url}</code>…`
        );
        addLog(
          "info",
          "upload",
          `POST ${url} with ${files.length} file(s).`,
          Array.from(files).map((f) => ({
            name: f.name,
            size_bytes: f.size,
            type: f.type,
          }))
        );

        btnUpload.disabled = true;
        btnHealth.disabled = true;

        try {
          const res = await fetch(url, {
            method: "POST",
            body: form,
          });

          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch {
            data = text;
          }

          if (res.ok) {
            const count = (data && data.count) || files.length;
            uploadCount += count;
            metricUploads.textContent = uploadCount.toString();
            metricBatch.textContent = String(count);

            setStatus(
              "ok",
              `<span class="status-text-strong">Uploaded</span> ${count} frame(s) successfully.`
            );
            addLog("ok", "upload OK", `Response ${res.status}`, data);
          } else {
            setStatus(
              "error",
              `<span class="status-text-strong">Upload failed</span> · status ${res.status}`
            );

            addLog("error", "upload error", `Response ${res.status}`, data);
          }
        } catch (err) {
          setStatus(
            "error",
            `<span class="status-text-strong">Network error</span> while sending frames.`
          );
          addLog("error", "upload error", "Network error while calling /upload_frame", String(err));
        } finally {
          btnUpload.disabled = false;
          btnHealth.disabled = false;
        }
      });

      // Initial auto health-check after short delay
      setTimeout(() => {
        addLog("info", "session", "Dashboard loaded. Click “Check API Health” or upload frames.", null);
      }, 300);
    })();
  </script>
</body>
</html>


